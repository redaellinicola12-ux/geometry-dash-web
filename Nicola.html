<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Geometry Dash - HTML Clone</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: black;
  overflow: hidden;
}
canvas {
  display: block;
}
</style>
</head>

<body>

<canvas id="game"></canvas>

<audio id="music" loop>
  <source src="music.mp3" type="audio/mpeg">
</audio>

<script>
/* ===== CANVAS ===== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

/* ===== MUSIC ===== */
const music = document.getElementById("music");
music.volume = 0.5;

/* ===== GAME VARS ===== */
const groundY = canvas.height - 120;
let speed = 7;
let gravity = 1.2;
let score = 0;
let gameOver = false;

/* ===== PLAYER ===== */
const player = {
  x: 120,
  y: groundY - 40,
  size: 40,
  vy: 0,
  jumping: false
};

/* ===== OBSTACLES ===== */
let obstacles = [];

function spawnObstacle() {
  obstacles.push({
    x: canvas.width,
    size: 40 + Math.random() * 30
  });
}
setInterval(spawnObstacle, 1200);

/* ===== INPUT ===== */
function jump() {
  if (!player.jumping) {
    player.vy = -20;
    player.jumping = true;
  }
}
addEventListener("mousedown", startGame);
addEventListener("touchstart", startGame);
addEventListener("keydown", e => {
  if (e.code === "Space") startGame();
});

function startGame() {
  if (gameOver) location.reload();
  music.play();
  jump();
}

/* ===== UPDATE ===== */
function update() {
  if (gameOver) return;

  score++;

  // Player physics
  player.vy += gravity;
  player.y += player.vy;

  if (player.y >= groundY - player.size) {
    player.y = groundY - player.size;
    player.vy = 0;
    player.jumping = false;
  }

  // Obstacles
  obstacles.forEach(o => o.x -= speed);
  obstacles = obstacles.filter(o => o.x + o.size > 0);

  // Collision
  obstacles.forEach(o => {
    if (
      player.x < o.x + o.size &&
      player.x + player.size > o.x &&
      player.y + player.size > groundY - o.size
    ) {
      gameOver = true;
      music.pause();
    }
  });
}

/* ===== DRAW ===== */
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Background
  ctx.fillStyle = `hsl(${score % 360}, 60%, 10%)`;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Ground
  ctx.fillStyle = "#00ffff";
  ctx.fillRect(0, groundY, canvas.width, 6);

  // Player (cube)
  ctx.fillStyle = "#ff00ff";
  ctx.fillRect(player.x, player.y, player.size, player.size);

  // Obstacles (spikes)
  ctx.fillStyle = "white";
  obstacles.forEach(o => {
    ctx.beginPath();
    ctx.moveTo(o.x, groundY);
    ctx.lineTo(o.x + o.size / 2, groundY - o.size);
    ctx.lineTo(o.x + o.size, groundY);
    ctx.fill();
  });

  // UI
  ctx.fillStyle = "white";
  ctx.font = "20px Arial";
  ctx.fillText("Score: " + score, 20, 30);

  if (gameOver) {
    ctx.font = "40px Arial";
    ctx.fillText("GAME OVER", canvas.width / 2 - 140, canvas.height / 2);
    ctx.font = "18px Arial";
    ctx.fillText("Clicca per ricominciare",
      canvas.width / 2 - 120, canvas.height / 2 + 40);
  }
}

/* ===== LOOP ===== */
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
